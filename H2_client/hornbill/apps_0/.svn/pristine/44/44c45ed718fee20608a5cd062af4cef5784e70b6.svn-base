/*! MLSPassport - v0.0.1 - 2015-09-02 - www.meilishuo.com - */!function(){"use strict";function a(a){this.init(a)}function b(){return{validate:function(a,b,c,d){function e(a,b){if("object"==typeof a){var c={};for(var d in a)if(!R[d]){R[d]=[];var e=a[d];for(var f in e){var g=f.split("=");R[d][g[0]]=[L[g[0]],g[1],e[f]]}c[d]=R[d]}b||m(c)}}function f(a,b){b?P.splice(0,0,a):P.push(a),g()}function g(){Q=P.length}function h(a){if(d.success){var b=d.success.split("="),c=a.parentNode.getElementsByTagName(b[0])[0];c&&(c.className=b[1])}}function i(a){if(d.error){var b=d.error.split("="),c=a.parentNode.getElementsByTagName(b[0])[0];c&&(c.className=b[1])}}function j(){for(var a in R){var b=O[a];k(b)}}function k(a){var b=document.getElementById("msg"+a.name);if(b&&b.parentNode.removeChild(b),d.success){var c=d.success.split("=");a.parentNode.getElementsByTagName(c[0])[0].className=""}if(d.error){var e=d.error.split("=");a.parentNode.getElementsByTagName(e[0])[0].className=""}}function l(a,b,c){N&&(c=N);var e=a[b.name];for(var f in e){var g=document.getElementById("msg"+b.name);if(g&&g.parentNode.removeChild(g),"indexOf"!=f&&!e[f][0](b,e[f][1]))return q(b,e[f][2],c),!1}return d.isExist&&d.isExist[b.name]?I(b,c,d.isExist[b.name]):h(b),!0}function m(a,b,c){for(var d in a){var e=O[d];e.onblur=function(){l(a,this,b)},"checkbox"===e.type&&(e.onclick=function(){l(a,this,b)})}"function"==typeof c&&c()}function n(a,b){o(K);var c=b.parentNode;c.appendChild(a)}function o(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];3!=c.nodeType||/\S/.test(c.nodeValue)||c.parentNode.removeChild(c)}}function p(a,b,c){if("string"==typeof b){if(""===b)return void h(a);i(a);var d=(u(c),document.createElement("div"));d.setAttribute("id","msg"+a.name),d.className=c,d.innerHTML="<span></span>"+b,n(d,a)}}function q(a,b,c){var d=function(b){p(a,b,c)};return"function"==typeof b?void b(d):void d(b)}function r(a,b,c){var d=b.split("."),e=u(d[0],K)[0];e.onclick=function(){for(var b in a){var e=O[b],f=a[e.name];for(var g in f)if("indexOf"!=g&&!f[g][0](e,f[g][1]))return void(u(d[1],K)[0].innerHTML=f[g][2])}"function"==typeof c&&c()}}function s(){if(0!=Q){var a=P[--Q];"function"==typeof a&&a()}}function t(a,b){var c=u(b)[0];c.onclick=function(){for(var c in a){var e=O[c];if(!e.getAttribute("novalid")&&!l(a,e,b))return}clearTimeout(_),_=setTimeout(function(){for(var b in a){var c=O[b],e=d.error.split("="),f=c.parentNode.getElementsByTagName(e[0])[0];if(f&&(f.className==e[1]||""==f.className))return}g(),s()},500)}}function u(a,b,c){null==b&&(b=document),null==c&&(c="*");for(var d=new Array,e=b.getElementsByTagName(c),f=" "+a+" ",g=0,h=0;g<e.length;g++){var i=" "+e[g].className+" ";-1!=i.indexOf(f)&&(d[h++]=e[g])}return d}function v(a,b){var c=a.value;return""!=c&&c!=b}function w(a,b){return a.value.length<=b}function x(a,b){return a.value.length>=b}function y(a){var b=/^([a-zA-Z0-9]+[_|\_|\.|\-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return b.test(a.value)}function z(a){var b=/^\d{11}$/;return b.test(a.value)}function A(a){var b=/^(([0\+]\d{2,3}-)?(0\d{2,3}-?)|400|800)(\d{7,8})(-(\d+))?$/;return b.test(a.value)}function B(a){return z(a)||A(a)}function C(a){var b=/^[0-9]{6}$/;return b.test(a.value)}function D(a,b){var c={yahoo:["@yahoo","@ymail"]};if(!(b in c))return!0;for(var d=!0,e=c[b],f=e.length;f--;)if(a.value.indexOf(e[f])>-1){d=!1;break}return d}function E(b,c){var d=document.forms[a].elements[c].value;return""==d||""==b.value?!0:b.value===d}function F(a,b){var c=0;for(var d in a)a[d].checked&&c++;return b>c}function G(a,b){var c=0;for(var d in a)a[d].checked&&c++;return c>b}function H(a){return a.checked}function I(a,b,c){c(function(c){p(a,c,b)})}function J(a){return B(a)||z(a)}var K=document.forms[a];if(!K)return void alert("不存在这个表单:"+a);var L={req:v,maxlen:w,minlen:x,email:y,canEmail:D,mobile:z,tel:A,phone:B,postcode:C,compare:E,selectmax:F,selectmin:G,selectradio:H,contact:J},M={showmsgbyline:m,showmsgforsubmit:t,showmsgbyone:r},N="",O=K.elements,P=[],Q=0,R={};if("object"!=typeof b)return void alert("错误, validateRules参数错误... ");for(var S in b){var T=b[S];O[S];R[S]=[];for(var U in T){var V,W,X=T[U];-1!=(V=U.indexOf("="))&&(W=U.substring(V+1),U=U.substring(0,V));var Y=L[U];if(!Y)return void alert("错误, 不存在这个验证规则");R[S][U]=[Y,W,X]}}for(var Z in c){var $=Z.split("=");"showmsgbyline"==$[0]&&(N=$[1]),"showmsgforsubmit"==$[0]&&f(c[Z]),M[$[0]](R,$[1],c[Z])}var _;return{resetForm:j,next:s,addValidate:e,addSubmit:f}}}}function c(a){this.bridge_domain="meilishuo.com"}function d(b,c){var d=this;b=b||{},this.opts=b,this.passport=c||new a(b),this.mobile=this.opts.mobile||"0",this.passport.setName.call(this,"mobile"),this.opts.parents&&(this.parents=this.opts.parents),this.dom={},this.initDom(),this.doMobile(),this.setValidate(function(){d.doMobile()})}function e(b,c){var d=this;b=b||{},this.opts=b,this.passport=c||new a(b),this.risk_type=this.opts.risk_type||"pic",this.passport.setName.call(this,"risk"+this.risk_type),this.ruleid=this.opts.ruleid,this.opts.parents&&(this.parents=this.opts.parents),this.opts.success&&(this.success=function(){d.opts.success()}),this.dom={},this.initDom(),this.initInput(),this.setValidate(function(){d.doRisk()}),this.updateCaptcha()}function f(b,c){var d=this;b=b||{},this.opts=b,this.passport=c||new a(b),this.passport.setName.call(this,"login"),this.risk_sms_custom=0|this.opts.risk_sms_custom,this.risk_reactive_custom=0|this.opts.risk_reactive_custom,this.opts.watch&&this.addWatch(this.opts.watch),this.dom={},this.passport.bridge.cookie.set("LOGON_FROM",document.referrer),this.loginStart=function(){d.initDom(),d.initInput(),d.setValidate(function(){d.doLogin()})},this.loginDone=this.opts.loginDone||function(){},this.checkLogin()}function g(b,c){var d=this;b=b||{},this.opts=b,this.passport=c||new a(b),this.passport.setName.call(this,"logout"),this.opts.watch&&this.addWatch(this.opts.watch),this.dom={},this.dom.outer=$(this.opts.outer||"#logoutBox"),this.dom.outer.on("click",function(){d.doLogout()})}!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.passport=a,window.MLSPassport.content={},a.prototype.init=function(a){a=a||{},this.opts=a,this.app_id=a.app_id,this.getBridge(a),this.defaultCSS=0|this.opts.defaultCSS,this.defaultCSS&&this.bridge.loadCssFile("/css/passport.css")},a.prototype.getLogin=function(a){var b=new f($.extend({},{},a),this);return b},a.prototype.getLogout=function(a){var b=new g($.extend({},{},a),this);return b},a.prototype.getRisk=function(a){var b=new e($.extend({},{risk_type:"pic"},a),this);return b},a.prototype.getPicRisk=function(a){var b=new e($.extend({},{risk_type:"pic"},a),this);return b},a.prototype.getSMSRisk=function(a){var b=new e($.extend({},{risk_type:"sms"},a),this);return b},a.prototype.getReactiveRisk=function(a){var b=new e($.extend({},{risk_type:"reactive"},a),this);return b},a.prototype.getMobile=function(a){var b=new d($.extend({},{},a),this);return b},a.prototype.getMobileAndSMSRisk=function(a){var b=this;return{mobile:b.getMobile(a),risk:b.getSMSRisk($.extend({},{append:!0},a))}},a.prototype.getMobileAndReactiveRisk=function(a){var b=this;return{mobile:b.getMobile(a),risk:b.getReactiveRisk($.extend({},{append:!0},a))}},a.prototype.getBridge=function(a){return this.bridge=new c($.extend({},{},a),this),this.bridge.init(a),this.bridge},a.prototype.setName=function(a){this.name=a+(new Date).valueOf(),window.MLSPassport.content[this.name]=this},a.prototype.etic=function(a,b){a=a.replace(/[\r\t\n]/g," ").split("<?").join("	").replace(/((^|\?>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)\?>/g,"',$1,'").split("	").join("');").split("?>").join("p.push('").split("\r").join("\\'");try{var c=new Function("","var p=[];p.push('"+a+"');return p.join('');")}catch(d){console&&(console.log(d),console.log(a))}if(!b)return c;try{return c.apply(b)}catch(d){console&&(console.log(d),console.log(b))}},a.prototype.shareTmp=function(a,b){b=b||Object;try{var c=this.etic(a,b)}catch(d){fml.debug(d)}return c},!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.bridge=c,c.prototype.send=function(a){var b=this,c=window.location.href;a=this.getParams(a||c);var d=a.action||"",e=d.split("|")[0];switch(e){case"ajax":var f=window.top.MLSPassport.callbacks[a.action];f&&f(a.res);break;case"cookie":b.setCookie(a.cookie)}return this},c.prototype.setDomain=function(){return document.domain=this.bridge_domain,this},c.prototype.setCookie=function(a){this.cookie.set(a.key,a.value,{domain:a.domain,duration:a.expire})},c.prototype.cookie=function(){var a={cookieArr:{},options:{domain:".meilishuo.com",path:"/"},setCookie:function(a,b,c){c=c||{};var d=a+"="+encodeURIComponent(b);if(c.domain||(c.domain=this.options.domain),c.path||(c.path=this.options.path),d+="; domain="+c.domain,c.path&&(d+="; path="+c.path),c.duration){var e=new Date;e.setTime(e.getTime()+1e3*c.duration),d+="; expires="+e.toGMTString()}return c.secure&&(d+="; secure"),document.cookie=d+";"},getCookie:function(a){return this.cookieArr[a]=this.cookieArr[a]||function(){var b=window.document.cookie.match("(?:^|;)\\s*"+a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+"=([^;]*)");return b?decodeURIComponent(b[1]):void 0}(),this.cookieArr[a]},removeCookie:function(a){return this.setCookie(a,"",{duration:-1})}};return{set:function(b,c,d){return a.setCookie(b,c,d)},get:function(b){return a.getCookie(b)},remove:function(b){return a.removeCookie(b)}}}(),c.prototype.getParams=function(a){if(""==a)return"";for(var b,c,d,e={},f=a.indexOf("?")+1,g=-1==a.indexOf("#")?a.length:a.indexOf("#"),h=a.slice(f,g),i=h.split("&"),d=0,j=i.length;j>d;d++){var k=i[d].indexOf("=");if(k>0){b=i[d].substring(0,k),c=i[d].substr(k+1);try{c.indexOf("+")>-1&&(c=c.replace(/\+/g," ")),e[b]=decodeURIComponent(c)}catch(l){}}}return delete e.frm,e},c.prototype._iframes={},c.prototype._callbacks={},c.prototype._loadedCssFiles={},c.prototype.init=function(a){var b=this;this.opts=a||{},this.proxy=this.opts.proxy,this.protocol=this.proxy?"http://":document.location.protocol+"//",this.domain=this.getUrl(document.location.href);var c={"https://":{jcstatic:this.fixUrl(this.opts.jcstatic||"account.meilishuo.com"),domain:this.fixUrl(this.opts.domain||"account.meilishuo.com"),captcha:this.fixUrl(this.opts.captcha||"account.meilishuo.com")+"/Register/Captcha?token=asde39ad9"},"http://":{jcstatic:this.fixUrl(this.opts.jcstatic||"s.meilishuo.net"),domain:this.fixUrl(this.opts.domain||"www.meilishuo.com"),captcha:this.fixUrl(this.opts.captcha||"captcha.meilishuo.com")+"/Register/Captcha?token=asde39ad9"}};if(this.hosts=c[this.protocol]||c["http://"],this.proxy)for(var d in this.hosts)this.hosts[d]=this.proxy+encodeURIComponent(this.hosts[d]);this.blank=this.opts.blank,this.fixUrl(this.domain.hostDomain)==this.hosts.domain?this.bridge_type=0:this.domain.rootDomain==this.bridge_domain?this.bridge_type=1:this.bridge_type=2,window.MLSPassport.callbacks=b._callbacks||{}},c.prototype.loadCssFile=function(a,b){var a=this.hosts.jcstatic+a;if(this._loadedCssFiles[a])b&&b();else{this._loadedCssFiles[a]=!0;var c=document.createElement("link");c.rel="stylesheet",c.type="text/css",c.href=a,b&&(c.onload=b),document.getElementsByTagName("head")[0].appendChild(c)}return this},c.prototype.setCookies=function(a){for(var b=this,c=0;c<a.length;c++){var d=a[c];if("."+this.bridge_domain==d.domain)b.setCookie(d);else{var e="cookie|"+d.domain,f=this.blank+"?"+this.http_build_query({action:e,cookie:this.http_build_query(d)});this.addIframe(e,f)}}},c.prototype.addWatch=function(a){return!this.watchs&&(this.watchs=[]),this.watchs.push(a),this},c.prototype.watch=function(a){!this.watchs&&(this.watchs=[]);for(var b=this.watchs.length,c=0;b>c;c++)this.watchs[c](a);return this},c.prototype.addIframe=function(a,b,c){var d=this._iframes[a],c=c||{},e=c.data||{};e.timestamp=(new Date).valueOf(),b+=(/\?/.test(b)?"&":"?")+this.http_build_query(e),d?d.src=b:(d=document.createElement("iframe"),d.style.display="none",d.src=b,document.body.appendChild(d)),this._iframes[a]=d,c.callback&&(this._callbacks[a]=c.callback)},c.prototype.removeIframe=function(a){var b=this._iframes[a];b&&(document.body.removeChild(this._iframes[a]),delete this._iframes[a])},c.prototype.getUrl=function(a){if(!a)return"";if(""==a)return"";var b={};b=this.getParams(a);var c=document.createElement("A");c.href=a,b.hostDomain=c.host.split(":")[0];var d=b.hostDomain.replace(/\.(com|cn|net|org)/g,"");return d=d.substr(d.lastIndexOf(".")+1),b.rootDomain=b.hostDomain.substr(b.hostDomain.indexOf(d)),b},c.prototype.http_build_query=function(a,b,c){var d,e,f=[],g=function(a,b,c){var d,e=[];if(b===!0?b="1":b===!1&&(b="0"),null!=b){if("object"==typeof b){for(d in b)null!=b[d]&&e.push(g(a+"["+d+"]",b[d],c));return e.join(c)}if("function"!=typeof b)return encodeURIComponent(a)+"="+encodeURIComponent(b);throw new Error("There was an error processing for http_build_query().")}return""};c||(c="&");for(e in a){d=a[e],b&&!isNaN(e)&&(e=String(b)+e);var h=g(e,d,c);""!==h&&f.push(h)}return f.join(c)},c.prototype.redirect=function(a){var b=/MSIE (\d+\.\d+);/.test(navigator.userAgent);if(a||(location.href=location.href),b){var c=document.createElement("a");c.href=a,document.body.appendChild(c),c.click()}else location.href=a},c.prototype.fixUrl=function(a){return this.protocol+a.replace(/^http(s)?:\/\/|\/$/g,"")},c.prototype.ajax=function(a,b,c,d){var e=this,f="ajax|"+a+"|"+(new Date).valueOf(),g=function(a){if(e.removeIframe(f),"string"==typeof a)try{a=$.parseJSON(a)||{}}catch(b){console.log(b)}c(a),e.watch.call(d,a)};switch(e.bridge_type){case 0:$.post(e.hosts.domain+"/passport/aw"+a,b,g);break;case 1:e.setDomain();case 2:var h=e.hosts.domain+"/passport/blank"+a;b.jcstatic=e.hosts.jcstatic,b.bridge_type=e.bridge_type,b.bridge_src=e.blank,b.action=f,e.addIframe(f,h,{data:b,callback:g})}return this},!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.mobile=d,d.prototype.initDom=function(){var a=this,b=(this.passport,'<div class="passport-form-inner"><form class="passport-form" id="mobileForm" method="post" onsubmit="return false" action=""><?if(this.mobile && this.mobile !== \'0\'){?><div class="passport-form-list"><p class="passport-form-item"><span><?= this.mobile ?></span><input style="display:none;" class="passport-form-input" id="mobile" name="mobile" type="text" value="<?= this.mobile ?>"/></p></div><?}else{?><div class="passport-form-list"><p class="passport-form-item"><input class="passport-form-input" id="mobile" name="mobile" type="text" placeholder="<?= this.mobilePlaceholder ?>" maxlength="11"/><span></span><label for="mobile" class="icon-code"><?= this.mobileLabelText || \'\'?></label></p></div><?}?><div class="passport-form-message"></div><div class="sendSMSArea"><div class="passport-form-submit mobileBtn"><input type="submit" value="<?= this.submitBtnText || \'发送验证码\' ?>"/></div><div class="waitBox"><b></b>秒后可重新发送</div></div></form></div>'),c={mobilePlaceholder:"手机号",name:a.name,mobile:a.mobile};this.parents?(c.simple=1,this.ui=$.extend({},c,this.parents.ui)):this.ui=c;var d=this.passport.shareTmp(b,this.ui);this.dom.outer=$(this.opts.outer||"#mobileBox"),this.opts.append?this.dom.outer.append(d):this.dom.outer.html(d),this.dom.inner=this.dom.outer.find(".passport-form-inner"),this.dom.sendSMSArea=this.dom.outer.find(".sendSMSArea"),this.dom.mobileBtn=this.dom.sendSMSArea.find(".mobileBtn"),this.dom.waitBox=this.dom.sendSMSArea.find(".waitBox"),this.dom.waitNum=this.dom.waitBox.find("b"),this.parents?this.dom.msgArea=this.parents.dom.msgArea:this.dom.msgArea=this.opts.append?this.dom.inner.find(".passport-form-message"):this.dom.outer.find(".passport-form-message")},d.prototype.setValidate=function(a){var c={};this.mobile&&"0"!==this.mobile||(c={mobile:{}},c.mobile["req="+this.ui.mobilePlaceholder]="请输入手机号",c.mobile.mobile="手机号格式有误");var d="mobileForm",e={"showmsgbyline=msg_error":"","showmsgforsubmit=mobileBtn":a},f={success:"span=msg_ok",error:"span=msg_err"};this.validate=(new b).validate(d,c,e,f)},d.prototype.doMobile=function(){var a=this,b=this.passport,c={smstype:"active_sm_captcha"};this.dom.sendSMSArea.is(".waiting")||b.bridge.ajax("/sendsms",c,function(b){switch(a.dom.msgArea.html(b.message).show(),b.error_code){case 0:a.wait(60)}},this)},d.prototype.wait=function(a){function b(){return 0>a?void c.dom.sendSMSArea.removeClass("waiting"):(c.dom.waitNum.text(a--),void setTimeout(b,1e3))}var c=this;c.dom.sendSMSArea.addClass("waiting"),a=a||60,b()},d.prototype.addWatch=function(a){this.passport.bridge.addWatch.call(this,a)},!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.risk=e,e.prototype.initDom=function(){var a=this,b={captchaPlaceholder:"验证码",risk_type:this.risk_type,name:this.name};this.parents?(b.simple=1,this.ui=$.extend({},b,this.parents.ui)):this.ui=b;var c='<div class="passport-form-inner"><?if(this.simple !== 1){?><form class="passport-form" id="risk<?= this.risk_type ?>Form" method="post" onsubmit="return false" action=""><?}?><?if(this.risk_type == \'sms\' || this.risk_type == \'reactive\'){?><div class="passport-form-list"><p class="passport-form-item"><input class="passport-form-input" id="captcha" name="captcha" type="text" placeholder="<?= this.captchaPlaceholder ?>" maxlength="6"/><span></span><label for="captcha" class="icon-code"><?= this.captchaLabelText || \'\'?></label></p></div><?}?><?if(this.risk_type == \'pic\'){?><div class="passport-form-list captchaArea"><div class="passport-form-item"><input class="passport-form-input" id="captcha" name="captcha" type="text" placeholder="<?= this.captchaPlaceholder ?>" maxlength="4" /><span></span><label for="captcha" class="icon-code"><?= this.captchaLabelText || \'\'?></label><div class="captchaImage" onselectstart="return false;"><img width="90" height="36" src="http://i.meilishuo.net/css/images/register/blank.jpg"><span class="icon-refresh"></span></div></div></div><?}?><?if(this.simple !== 1){?><div class="passport-form-message"></div><div class="passport-form-submit passport-form-submit-<?= this.name?>"><input type="submit" value="<?= this.submitBtnText || \'立即验证\' ?>"/></div></form><?}?></div>',d=this.passport.shareTmp(c,this.ui);this.dom.outer=$(this.opts.outer||"#risk"+this.risk_type+"Box"),this.opts.append?this.dom.outer.append(d):this.dom.outer.html(d),this.dom.inner=this.dom.outer.find(".passport-form-inner"),this.dom.captchaArea=this.dom.outer.find(".captchaArea"),this.dom.captchaImage=this.dom.captchaArea.find("img"),this.parents?this.dom.msgArea=this.parents.dom.msgArea:this.dom.msgArea=this.opts.append?this.dom.inner.find(".passport-form-message"):this.dom.outer.find(".passport-form-message");var e;this.dom.captchaArea.on("click",".captchaImage",function(){e||(a.updateCaptcha(),e=1,setTimeout(function(){e=0},500))})},e.prototype.initInput=function(){for(var a=["captcha"],b=0;b<a.length;b++){var c=a[b];this.dom[c]=this.dom.outer.find("#"+c)}},e.prototype.setValidate=function(a){var c=this.parents,d={captcha:{}};d.captcha["req="+this.ui.captchaPlaceholder]="请输入验证码";var e="risk"+this.risk_type+"Form",f={"showmsgbyline=msg_error":""},g={success:"span=msg_ok",error:"span=msg_err"};c?c.validate?(c.validate.addValidate(d),c.validate.addSubmit(a)):(f["showmsgforsubmit=passport-form-submit-"+c.name]=a,this.validate=(new b).validate(e,d,f,g)):(f["showmsgforsubmit=passport-form-submit-"+this.name]=a,this.validate=(new b).validate(e,d,f,g))},e.prototype.doRisk=function(){var a=this,b=this.parents?this.parents.validate:this.validate,c={app_id:a.passport.app_id,ruleid:a.ruleid,captcha:a.dom.captcha.val()};this.passport.bridge.ajax("/risk"+this.risk_type,c,function(c){a.dom.msgArea.html(c.message).show(),0==c.error_code?(a.success&&a.success(),b&&b.next()):a.updateCaptcha()},this)},e.prototype.updateCaptcha=function(a){this.dom.captchaImage.attr("src",this.passport.bridge.hosts.captcha+"&session="+(new Date).valueOf()),a&&a()},e.prototype.addWatch=function(a){this.passport.bridge.addWatch.call(this,a)},!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.login=f,f.prototype.initDom=function(){var a=this.passport;this.ui=$.extend({},{usernamePlaceholder:"邮箱/手机号/昵称",passwordPlaceholder:"密码",name:this.name},this.opts.ui);var b='<div class="passport-form-inner"><form class="passport-form" id="<?= this.name ?>" method="post" onsubmit="return false" action=""><?if(this.formTitleShow !== 0){?><h3><?= this.formTitleText || \'登录美丽说\' ?></h3><?}?><div class="passport-form-list"><p class="passport-form-item"><input class="passport-form-input" id="username" name="username" type="text" placeholder="<?= this.usernamePlaceholder ?>" /><span></span><label for="username" class="icon-user"><?= this.usernameLabelText || \'\'?></label></p></div><div class="passport-form-list"><p class="passport-form-item"><input class="passport-form-input" id="password" name="password" type="password" placeholder="<?= this.passwordPlaceholder ?>" /><span></span><label for="password" class="icon-pwd"><?= this.passwordLabelText || \'\'?></label></p></div><div id="riskpicBox"></div><div class="passport-form-message"></div><div class="passport-form-submit passport-form-submit-<?= this.name?>"><input type="submit" value="<?= this.submitBtnText || \'立即登录\' ?>"/></div><?if(this.rememberBtnShow !== 0){?><div class="btn-remember"><input type="checkbox" name="remember" id="remember" checked="checked" /><label for="remember"><?= this.rememberBtnText || \'记住我\' ?></label></div><?}?><?if(this.findBtnShow !== 0){?><div class="btn-find"><a href="https://account.meilishuo.com/user/findPwd" target="_blank"><?= this.findBtnText || \'忘记密码？\'?></a></div><?}?><?if(this.registerBtnShow !== 0){?><div class="btn-register"><a href="https://account.meilishuo.com/user/register"><?= this.registerBtnText || \'注册\' ?></a></div><?}?></form></div>';this.dom.outer=$(this.opts.outer||"#loginBox").html(a.shareTmp(b,this.ui)),this.dom.inner=this.dom.outer.find(".passport-form-inner"),this.dom.msgArea=this.dom.outer.find(".passport-form-message")},f.prototype.initInput=function(){for(var a=["username","password","remember"],b=0;b<a.length;b++){var c=a[b];this.dom[c]=this.dom.outer.find("#"+c)}},f.prototype.setValidate=function(a){var c={username:{},password:{}};c.username["req="+this.ui.usernamePlaceholder]="请输入您的用户名或注册邮箱",c.password["req="+this.ui.passwordPlaceholder]="请输入密码",c.password["minlen=6"]="输入密码需在6位到32位间",c.password["maxlen=32"]="输入密码需在6位到32位间";var d=this.name,e={success:"span=msg_ok",error:"span=msg_err"},f={"showmsgbyline=msg_error":""};f["showmsgforsubmit=passport-form-submit-"+this.name]=a,this.validate=(new b).validate(d,c,f,e)},f.prototype.doLogin=function(){var a=this,b=this.passport,c={app_id:b.app_id,username:a.dom.username.val(),password:a.dom.password.val(),remember:a.dom.remember[0].checked?1:0};console.log("doLogin"),b.bridge.ajax("/login",c,function(c){switch(a.dom.msgArea.html(c.message).show(),c.error_code){case 0:console.log("session",c.data.session),c.data.session&&b.bridge.setCookies(c.data.session),console.log("redirect",c.data.redirect),c.data.redirect&&b.bridge.redirect(c.data.redirect);break;case 1004:a.ruleid=c.data.ruleid,a.risk_sms_custom||c.data.mobile&&"0"!==c.data.mobile&&(a.mobileAndSMSRisk||(a.mobileAndSMSRisk=b.getMobileAndSMSRisk({ruleid:a.ruleid,mobile:c.data.mobile})));break;case 1005:a.ruleid=c.data.ruleid,a.riskpic||(a.riskpic=b.getPicRisk({ruleid:a.ruleid,parents:a})),a.riskpic.updateCaptcha();break;case 1007:a.risk_reactive_custom||a.mobileAndReactiveRisk||(a.mobileAndReactiveRisk=b.getMobileAndReactiveRisk({ruleid:a.ruleid,mobile:c.data.mobile}))}},this)},f.prototype.checkLogin=function(a){var b=this,c=this.passport;c.bridge.ajax("/init",{app_id:c.app_id},function(c){if(b.ruleid=c.data.ruleid,"function"==typeof a)a(c);else switch(c.error_code){case 0:b.loginDone&&b.loginDone(c);break;case 10001:b.loginStart&&b.loginStart(c)}},this)},f.prototype.addWatch=function(a){this.passport.bridge.addWatch.call(this,a)},!window.MLSPassport&&(window.MLSPassport={}),window.MLSPassport.logout=g,g.prototype.doLogout=function(){var a=this.passport,b={app_id:a.app_id};a.bridge.ajax("/logout",b,function(a){},this)},g.prototype.addWatch=function(a){this.passport.bridge.addWatch.call(this,a)}}();